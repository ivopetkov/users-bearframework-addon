/*
 * Users addon for Bear Framework
 * https://github.com/ivopetkov/users-bearframework-addon
 * Copyright (c) Ivo Petkov
 * Free to use under the MIT license.
 */
var ivoPetkov=ivoPetkov||{};ivoPetkov.bearFrameworkAddons=ivoPetkov.bearFrameworkAddons||{};
ivoPetkov.bearFrameworkAddons.users=ivoPetkov.bearFrameworkAddons.users||function(){var e=!1,h=function(a){if("function"===typeof Event)return new Event(a);var b=document.createEvent("Event");b.initEvent(a,!1,!1);return b},k=function(){var a=document.querySelector(".ivopetkov-users-badge");a&&a.parentNode.removeChild(a)},g=new function(){var a={};this.addEventListener=function(b,d){"undefined"===typeof a[b]&&(a[b]=[]);a[b].push(d)};this.removeEventListener=function(b,d){if("undefined"!==typeof a[b])for(var c=
a[b],f=0;f<c.length;f++)if(c[f]===d){c.splice(f,1);break}};this.dispatchEvent=function(b){if("undefined"===typeof a[b.type])return!0;for(var d=a[b.type],c=0;c<d.length;c++)d[c].call(this,b);return!b.defaultPrevented}};return{currentUser:{exists:function(){return e},addEventListener:function(a,b){g.addEventListener(a,b)},removeEventListener:function(a,b){g.removeEventListener(a,b)}},initialize:function(a){e="undefined"!==typeof a?0<a:!1},login:function(a){clientShortcuts.get("lightbox").then(function(b){b.wait(function(b){clientShortcuts.get("serverRequests").then(function(c){c.send("ivopetkov-users-login",
{provider:a,location:window.location.toString()}).then(function(a){a=JSON.parse(a);"1"===a.status&&(e=!0,"undefined"!==typeof a.jsCode&&(new Function(a.jsCode))(),"undefined"!==typeof a.redirectUrl?window.location=a.redirectUrl:(html5DOMDocument.insert(a.badgeHTML),b.close(),g.dispatchEvent(h("change"))))})})})})},logout:function(){clientShortcuts.get("lightbox").then(function(a){a.wait(function(a){clientShortcuts.get("serverRequests").then(function(b){b.send("ivopetkov-users-logout").then(function(b){"1"===
JSON.parse(b).status&&(e=!1,k(""),a.close(),g.dispatchEvent(h("change")))})})})})},openLogin:function(){clientShortcuts.get("lightbox").then(function(a){a.wait(function(a){clientShortcuts.get("serverRequests").then(function(b){b.send("ivopetkov-users-login-screen").then(function(b){b=JSON.parse(b);"undefined"!==typeof b.html&&a.open(b.html)})})})})},openSettings:function(){clientShortcuts.get("lightbox").then(function(a){a.wait(function(a){clientShortcuts.get("serverRequests").then(function(b){b.send("ivopetkov-users-settings-window").then(function(b){b=
JSON.parse(b);"undefined"!==typeof b.html&&a.open(b.html)})})})})},openPreview:function(a,b){"undefined"!==typeof a&&"undefined"!==typeof b&&clientShortcuts.get("lightbox").then(function(d){d.wait(function(c){var d={provider:a,id:b};clientShortcuts.get("serverRequests").then(function(a){a.send("ivopetkov-users-preview-window",d).then(function(a){a=JSON.parse(a);"undefined"!==typeof a.html&&c.open(a.html)})["catch"](function(){c.close()})})})})},_updateBadge:function(){clientShortcuts.get("serverRequests").then(function(a){a.send("ivopetkov-users-badge").then(function(a){a=
JSON.parse(a);"undefined"!==typeof a.html&&(k(),""!==a.html&&html5DOMDocument.insert(a.html))})})}}}();
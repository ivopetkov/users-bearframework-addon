/*
 * Users addon for Bear Framework
 * https://github.com/ivopetkov/users-bearframework-addon
 * Copyright (c) 2016-2017 Ivo Petkov
 * Free to use under the MIT license.
 */
var ivoPetkov=ivoPetkov||{};ivoPetkov.bearFrameworkAddons=ivoPetkov.bearFrameworkAddons||{};
ivoPetkov.bearFrameworkAddons.users=function(){var c=null,b=null,d=[],g="",h="",m=function(){k();ivoPetkov.bearFrameworkAddons.serverRequests.send("ivopetkov-users-logout",{},function(a){"1"===JSON.parse(a).status&&(a=document.querySelector(".ivopetkov-users-badge"))&&(b=null,a.parentNode.removeChild(a),e())})},l=function(a,n){var b=document.querySelector(".ivopetkov-users-window").querySelector('[data-ivopetkov-users-type="'+a+'"]');null!==b&&b.addEventListener("click",n)},p=function(a){a={type:a,
location:window.location.toString()};k();ivoPetkov.bearFrameworkAddons.serverRequests.send("ivopetkov-users-login",a,function(a){a=JSON.parse(a);"1"===a.status&&("undefined"!==typeof a.redirectUrl?window.location=a.redirectUrl:(html5DOMDocument.insert(a.badgeHTML),b=a.currentUser,e()))})},f=function(a){e();c=new ivoPetkov.bearFrameworkAddons.jsLightbox({images:[{html:'<div class="ivopetkov-users-window">'+a+"</div>"}]});c.open(0);for(var b in d)a=d[b],l(a.id,function(a){return function(){p(a)}}(a.id));
l("logout",m)},k=function(){f(""+('<div class="ivopetkov-users-loading">'+g+"</div>"))},e=function(){null!==c&&(c.close(),c=null)};return{currentUser:{exists:function(){return null!==b}},initialize:function(a){b=a.currentUser;d=a.providers;g=a.pleaseWaitText;h=a.logoutButtonText},showLogin:function(){var a="",b;for(b in d)var c=d[b],a=a+('<div><a class="ivopetkov-users-login-option-button" data-ivopetkov-users-type="'+c.id+'">'+c.buttonText+"</a></div>");f(a)},showAccount:function(){if(null!==b){var a=
"";0<b.imageLarge.length&&(a+='<div><div class="ivopetkov-users-account-image" style="background-image:url('+b.imageLarge+');"></div></div>');0<b.name.length&&(a+='<div><div class="ivopetkov-users-account-name">'+b.name+"</div></div>");0<b.descriptionHTML.length&&(a+='<div><div class="ivopetkov-users-account-description">'+b.descriptionHTML+"</div></div>");0<b.hasLogout&&(a+='<div><a class="ivopetkov-users-account-logout-button" data-ivopetkov-users-type="logout">'+h+"</a></div>");f(a)}}}}();
/*
 * Users addon for Bear Framework
 * https://github.com/ivopetkov/users-bearframework-addon
 * Copyright (c) Ivo Petkov
 * Free to use under the MIT license.
 */
var ivoPetkov=ivoPetkov||{};ivoPetkov.bearFrameworkAddons=ivoPetkov.bearFrameworkAddons||{},ivoPetkov.bearFrameworkAddons.users=ivoPetkov.bearFrameworkAddons.users||function(){var e=null,n=function(){o.dispatchEvent(function(e){if("function"==typeof Event)return new Event(e);var n=document.createEvent("Event");return n.initEvent(e,!1,!1),n}("change"))},t=function(e,n,t){void 0===t&&(t={}),clientPackages.get("modalWindows").then((function(o){o.open("ivopetkov-users-screen-window",{provider:e,id:n,data:t})}))},o=new function(){var e={};this.addEventListener=function(n,t){void 0===e[n]&&(e[n]=[]),e[n].push(t)},this.removeEventListener=function(n,t){if(void 0!==e[n])for(var o=e[n],i=0;i<o.length;i++)if(o[i]===t)return void o.splice(i,1)},this.dispatchEvent=function(n){if(void 0===e[n.type])return!0;for(var t=e[n.type],o=0;o<t.length;o++)t[o].call(this,n);return!n.defaultPrevented}};Promise=window.Promise||function(e){var n=[],t=null;this.then=function(e){return n.push(e),this},this.catch=function(e){return null===t&&(t=e),this};var o=function(){for(var e in n)n[e].apply(null,arguments)},i=function(){null!==t&&t.apply(null,arguments)};window.setTimeout((function(){e(o,i)}),16)};var i=function(){var e=window.location.hash;if(0===e.indexOf("#/-u/")){history.replaceState("","",window.location.href.replace(e,""));var n=e.replace("#/-u/",""),o=n.split("/");t(o[0],"-hash-callback",{path:n.substring(o[0].length+1)})}};return document.addEventListener("readystatechange",()=>{i()}),"complete"===document.readyState&&i(),{currentUser:{exists:function(){return new Promise((function(t,o){null===e?clientPackages.get("serverRequests").then((function(o){o.send("ivopetkov-users-currentuser-exists").then((function(o){var i=JSON.parse(o);"1"===i.status&&(e="1"===i.exists,n(),t(e))}))})):t(e)}))},addEventListener:function(e,n){o.addEventListener(e,n)},removeEventListener:function(e,n){o.removeEventListener(e,n)}},login:function(t){clientPackages.get("modalWindows").then((function(o){o.closeAll(),o.showLoading(),clientPackages.get("serverRequests").then((function(i){var r={provider:t,location:window.location.toString()};i.send("ivopetkov-users-login",r).then((function(t){var i=JSON.parse(t);"1"===i.status&&(e=!0,void 0!==i.jsCode&&new Function(i.jsCode)(),void 0!==i.redirectUrl?window.location=i.redirectUrl:(html5DOMDocument.insert(i.badgeHTML),o.hideLoading(),o.closeAll(),n()))}))}))}))},logout:function(){clientPackages.get("modalWindows").then((function(e){e.closeAll(),e.showLoading(),clientPackages.get("serverRequests").then((function(e){e.send("ivopetkov-users-logout").then((function(e){"1"===JSON.parse(e).status&&window.location.reload()}))}))}))},openLogin:function(){clientPackages.get("modalWindows").then((function(e){e.open("ivopetkov-users-login-screen")}))},openPreview:function(e,n){void 0!==e&&void 0!==n&&clientPackages.get("modalWindows").then((function(t){t.open("ivopetkov-users-preview-window",{provider:e,id:n})}))},openProviderScreen:t,openProviderLogin:function(e){t(e,"login")},openProviderSignup:function(e){t(e,"signup")},_closeCurrentWindow:function(){clientPackages.get("modalWindows").then((function(e){e.closeCurrent()}))},_closeAllWindows:function(){clientPackages.get("modalWindows").then((function(e){e.closeAll()}))},_showLoading:function(){clientPackages.get("modalWindows").then((function(e){e.showLoading()}))},_updateBadge:function(e){var n;(n=document.querySelector(".ivopetkov-users-badge"))&&(n.parentNode.removeChild(n),1)&&html5DOMDocument.insert(e)}}}();
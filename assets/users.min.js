/*
 * Users addon for Bear Framework
 * https://github.com/ivopetkov/users-bearframework-addon
 * Copyright (c) 2016-2017 Ivo Petkov
 * Free to use under the MIT license.
 */
var ivoPetkov=ivoPetkov||{};ivoPetkov.bearFrameworkAddons=ivoPetkov.bearFrameworkAddons||{};
"undefined"===typeof ivoPetkov.bearFrameworkAddons.users&&(ivoPetkov.bearFrameworkAddons.users=function(){var c=null,b=null,d=[],h="",k="",l="",n=function(){m();ivoPetkov.bearFrameworkAddons.serverRequests.send("ivopetkov-users-logout",{},function(a){"1"===JSON.parse(a).status&&(a=document.querySelector(".ivopetkov-users-badge"))&&(b=null,a.parentNode.removeChild(a),f())})},g=function(a,p){var b=document.querySelector(".ivopetkov-users-window").querySelector('[data-ivopetkov-users-type="'+a+'"]');
null!==b&&b.addEventListener("click",p)},q=function(a){a={type:a,location:window.location.toString()};m();ivoPetkov.bearFrameworkAddons.serverRequests.send("ivopetkov-users-login",a,function(a){a=JSON.parse(a);"1"===a.status&&("undefined"!==typeof a.jsCode&&(new Function(a.jsCode))(),"undefined"!==typeof a.redirectUrl?window.location=a.redirectUrl:(html5DOMDocument.insert(a.badgeHTML),b=a.currentUser,f()))})},r=function(){ivoPetkov.bearFrameworkAddons.serverRequests.send("ivopetkov-guest-settings-form",
{},function(a){a=JSON.parse(a);e('<div id="ivopetkov-users-guest-settings-form"></div>');html5DOMDocument.insert(a.html,[document.getElementById("ivopetkov-users-guest-settings-form")])})},e=function(a){f();c=new ivoPetkov.bearFrameworkAddons.jsLightbox({images:[{html:'<div class="ivopetkov-users-window"><div>'+a+"</div></div>"}]});c.open(0);for(var b in d)a=d[b],g(a.id,function(a){return function(){q(a)}}(a.id));g("logout",n);g("guest-settings",r)},m=function(){e(""+('<div class="ivopetkov-users-loading">'+
h+"</div>"))},f=function(){null!==c&&(c.close(),c=null)};return{currentUser:{exists:function(){return null!==b}},initialize:function(a){b=a.currentUser;d=a.providers;h=a.pleaseWaitText;k=a.logoutButtonText;l=a.profileSettingsText},showLogin:function(){var a="",b;for(b in d){var c=d[b];c.hasLoginButton&&(a+='<div><a class="ivopetkov-users-login-option-button" data-ivopetkov-users-type="'+c.id+'">'+c.loginButtonText+"</a></div>")}e(a)},showAccount:function(){if(null!==b){var a=function(a){return a.replace(/[<>\&\"\']/g,
function(a){return"&#"+a.charCodeAt(0)+";"})},c="";0<b.image.length&&(c+='<div><div class="ivopetkov-users-account-image" style="background-image:url('+b.image+');"></div></div>');0<b.name.length&&(c+='<div><div class="ivopetkov-users-account-name">'+a(b.name)+"</div></div>");0<b.description.length&&(c+='<div><div class="ivopetkov-users-account-description">'+a(b.description)+"</div></div>");0<b.url.length&&(c+='<div><div class="ivopetkov-users-account-url"><a href="'+a(b.url)+'" target="_blank">'+
a(b.url)+"</a></div></div>");0<b.hasSettingsButton&&(c+='<div><a class="ivopetkov-guest-settings-button" data-ivopetkov-users-type="guest-settings">'+l+"</a></div>");0<b.hasLogoutButton&&(c+='<div><a class="ivopetkov-users-account-logout-button" data-ivopetkov-users-type="logout"'+(0<b.hasSettingsButton?' style="margin-top:0;"':"")+">"+k+"</a></div>");e(c)}}}}());